# 初回利用時

- 各リージョンのコンソールに初回アクセス時、LakeFormationの管理者の登録が要求される
  - 登録できるのはIAMユーザまたはIAMロール
  - 最大10のユーザまたはロールを登録可能
  - 管理者権限をもつユーザの場合、後から管理者の追加、削除は可能


- カラム単位でのアクセス制限も可能
  - ただしパーティションカラムは制限できない
- 


## 暗黙的な許可
AWS Lake Formationは、データレイク管理者、データベース作成者、テーブル作成者、およびデータレイクユーザーに次の暗黙的なアクセス許可を付与します。

- データレイク管理者
  - データカタログ内のすべてのオブジェクトへの完全なメタデータアクセスがあります。このアクセスは管理者から取り消すことはできません。
  - データレイク内のすべての場所にデータの場所のアクセス許可があります。
  - データカタログ内のオブジェクトへのアクセスをプリンシパル（selfを含む）に許可できます。このアクセスは管理者から取り消すことはできません。
  - データカタログにデータベースを作成できます。
  - 別のユーザーにデータベースを作成する権限を付与できます。
  - Amazon Simple Storage Service（Amazon S3）の場所を登録できます。
  - 注意
    - データレイク管理者には、データベースを削除したり、テーブルを変更または削除したりするための暗黙的な権限はありません。ただし、そのための権限を自分で付与できます。
- データベース作成者
  - 作成するデータベース内のすべてのテーブルに対するすべての権限を持ちます。
- テーブル作成者
  - 作成するテーブルに対するすべての権限を持ちます。
  - 作成するすべてのテーブルにアクセス許可を付与できます。
- データレイクユーザー
  - 権限を持つデータベースまたはテーブルを表示および一覧表示できます。


- DB作成時に「Use only IAM access control for new tables in this database」のチェックを入れるとLakeFormationへのアクセス権限を持つユーザがデフォルトでそのユーザDBへアクセスできる状態になる
- 権限の認可、拒否設定はIAMユーザ、ロール、グループに対して制御可能
  - グループは要検証

- 別リージョンのバケットのデータでも制御可能
- cli は v1.16.220からLakeFormation API使用可能
- 




- 登録済みバケットのDB
  - table1
  - table2
  - table3(未登録パスにつくる)
- 未登録バケットのDB
  - table1
  - table2
  - table3（登録パスにつくる）
  


# ブログタイトル

2019年8月にAWS Lake Formationが一般公開となりました。
Lake Formationを利用することでデータレイクの構築やアクセス制御を統合管理できるようになりました。
この記事ではアクセス制御について紹介したいと思います。


# Lake Formation とは
公式では「安全なデータレイクを数日で簡単にセットアップできるサービス」と書かれています。数日触った感覚だとAWS Glue ＋ アクセス制御の管理機能といった印象になります。

## 機能一覧

- S3登録
  - データレイクとなるS3のパスを登録・削除できます。
  - 登録したS3パス配下をLakeFromationで管理することができるようになります。
- データカタログ管理
  - ＝ Glueの機能になります。Glue、LakeFormationどちらからでも管理できます
  - データカタログはGlueとLakeFormationで共有されています。
- Buleprints
  - 何種類かのテンプレートからWorkFlowを作成できます
  - WorkFlowとはETL処理をひとまとめにしたものです。
  - テンプレートから定期的にCloudTrailやRDBのデータをデータレイクに出力させるようなWorkFlowを作る事ができるようです。
- **アクセス制御**
  - データカタログへのアクセス権限をIAMユーザユーザ/ロールに対してGrant/Revokeさせることができます。
  - アクセス権限はデータベース単位からテーブルのカラム単位まで細かく制御できます。

# アクセス制御をためしてみる。
実際にLake Formationでアクセス権限を設定して、実際に制御されているかどうか確認してみたいと思います。

## 検証用データカタログ構築

今回の検証用に以下の構成のデータカタログを構築しています。

TODO 表のせる

## Lake Formation初期設定

LakeFormationで上記データカタログを管理できるように設定していきます。

### LakeFormation管理者登録（LakeFormationコンソール初回アクセス時）

### データレイク登録
